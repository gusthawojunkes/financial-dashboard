<div class="import-container">
    <div class="card">
        <form (ngSubmit)="onSubmit()" class="form-container">
        
        <!-- Secção de Upload de Ficheiro -->
        <div>
            <label class="form-label">1. Envie o seu ficheiro</label>
            <div class="file-input-wrapper">
            <label for="file-upload" class="file-input-label" 
                   [class.dragging]="isDragging"
                   (dragover)="onDragOver($event)" 
                   (dragleave)="onDragLeave($event)" 
                   (drop)="onDrop($event)">
                <div class="file-input-content">
                <svg fill="none" viewBox="0 0 48 48" stroke="currentColor"><path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg>
                <p><span class="link-text">Clique para enviar</span> ou arraste e solte</p>
                <p class="file-types-text">OFX, PDF, CSV</p>
                <span class="file-name-text">{{ fileName }}</span>
                </div>
            </label>
            <input id="file-upload" type="file" (change)="onFileSelected($event)" accept=".ofx,.pdf,.csv">
            </div>
        </div>

        <!-- Secção de Parâmetros -->
        <div>
            <label class="form-label">2. Configure os parâmetros</label>
            <div class="params-container">
            
            <!-- Seletor de Instituição -->
            <div>
                <label for="institution-button" class="form-label">Instituição</label>
                <div class="dropdown-wrapper">
                <button type="button" id="institution-button" class="form-button" (click)="isDropdownOpen = !isDropdownOpen">
                    <span class="dropdown-selected-item">
                    <span class="bank-icon" [innerHTML]="selectedBank.icon | safeHtml"></span>
                    <span>{{ selectedBank.name }}</span>
                    </span>
                    <span class="dropdown-arrow">
                    <svg viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 3a.75.75 0 01.53.22l3.5 3.5a.75.75 0 01-1.06 1.06L10 4.81 7.03 7.78a.75.75 0 01-1.06-1.06l3.5-3.5A.75.75 0 0110 3zm-3.72 9.53a.75.75 0 011.06 0L10 15.19l2.97-2.97a.75.75 0 111.06 1.06l-3.5 3.5a.75.75 0 01-1.06 0l-3.5-3.5a.75.75 0 010-1.06z" clip-rule="evenodd"></path></svg>
                    </span>
                </button>
                <ul *ngIf="isDropdownOpen" class="dropdown-options">
                    <li *ngFor="let bank of banks" (click)="selectBank(bank)" class="dropdown-option">
                    <span class="bank-icon" [innerHTML]="bank.icon | safeHtml"></span>
                    <span>{{ bank.name }}</span>
                    </li>
                </ul>
                </div>
            </div>
            
            <!-- Outros Parâmetros -->
            <div>
                <label for="file-type" class="form-label">Tipo do Ficheiro</label>
                <select id="file-type" class="form-select" [(ngModel)]="fileType" name="fileType">
                <option>OFX</option>
                <option>CSV</option>
                <option>PDF</option>
                </select>
            </div>
            <div *ngIf="fileType === 'CSV'" class="csv-options">
                <div>
                <label for="csv-separator" class="form-label">Separador CSV</label>
                <input type="text" id="csv-separator" class="form-input" [(ngModel)]="csvSeparator" name="csvSeparator">
                </div>
                <div>
                <label for="datetime-pattern" class="form-label">Formato da Data/Hora</label>
                <input type="text" id="datetime-pattern" class="form-input" [(ngModel)]="datetimePattern" name="datetimePattern">
                </div>
            </div>
            <div>
                <label for="invoice-type" class="form-label">Tipo da Fatura</label>
                <select id="invoice-type" class="form-select" [(ngModel)]="invoiceType" name="invoiceType">
                <option>CREDIT_INVOICE</option>
                <option>DEBIT_INVOICE</option>
                </select>
            </div>
            </div>
        </div>
        
        <!-- Botão de Submissão -->
        <div>
            <button type="submit" class="btn btn-primary" [disabled]="isLoading">
            <span *ngIf="!isLoading">Analisar Transações</span>
            <span *ngIf="isLoading">{{ loadingMessage }}</span>
            </button>
        </div>
        </form>
        <div *ngIf="errorMessage" class="error-message">{{ errorMessage }}</div>
    </div>
</div>