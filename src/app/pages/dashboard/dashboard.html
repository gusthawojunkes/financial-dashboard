<div *ngIf="transactions.length > 0; else noData" class="dashboard-grid">
    <div class="summary-cards">
        <div class="card summary-card">
            <div class="summary-icon revenue-icon">
                <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="16" cy="16" r="14" stroke="#4CAF50" stroke-width="2" fill="#E8F5E9"/>
                    <text x="16" y="22" text-anchor="middle" font-size="18" font-family="Arial, Helvetica, sans-serif"
                          fill="#388E3C" font-weight="bold">$
                    </text>
                </svg>
            </div>
            <div>
                <p class="summary-title">Receitas</p>
                <p class="summary-value">{{ summary.revenue | currency:'BRL' }}</p>
            </div>
        </div>
        <div class="card summary-card">
            <div class="summary-icon expenses-icon">
                <svg fill="none" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M13 17h8m0 0V9m0 8l-8-8-4 4-6-6"></path>
                </svg>
            </div>
            <div>
                <p class="summary-title">Despesas</p>
                <p class="summary-value">{{ summary.expenses | currency:'BRL' }}</p>
            </div>
        </div>
        <div class="card summary-card">
            <div class="summary-icon balance-icon">
                <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect x="6" y="14" width="36" height="20" rx="4" fill="#FFF8E1" stroke="#FFB300" stroke-width="4"/>
                    <rect x="30" y="20" width="8" height="8" rx="2" fill="#FFECB3" stroke="#FFB300" stroke-width="2"/>
                    <path d="M6 18V14a4 4 0 0 1 4-4h28a4 4 0 0 1 4 4v4" stroke="#FFB300" stroke-width="2"/>
                </svg>
            </div>
            <div>
                <p class="summary-title">Saldo</p>
                <p class="summary-value" [class.positive]="summary.balance >= 0" [class.negative]="summary.balance < 0">
                    {{ summary.balance | currency:'BRL' }}
                </p>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="chart-header">
            <div class="chart-view-selector">
                <button
                    [class.selected]="selectedView === 'categoria'"
                    (click)="setView('categoria')"
                    class="selector-btn"
                    title="Despesas por categoria">
                    <span class="selector-icon" aria-hidden="true"
                          style="display:inline-flex;align-items:center;margin-right:4px;">
                        <img src="assets/icons/tag.svg" alt="Categoria Icon"
                             width="18" height="18" style="fill:currentColor;"/>
                    </span>
                    Categoria
                </button>
                <button
                    [class.selected]="selectedView === 'banco'"
                    (click)="setView('banco')"
                    class="selector-btn"
                    title="Despesas por banco">
                    <span class="selector-icon" aria-hidden="true"
                          style="display:inline-flex;align-items:center;margin-right:4px;">
                        <!-- Ícone de banco (colunas clássicas) -->
                        <img src="assets/icons/bank.svg" alt="Receitas Icon"
                             width="18" height="18" style="fill:currentColor;"/>
                    </span>
                    Banco
                </button>
                <button
                    (click)="showRevenueByYearChart()"
                    class="selector-btn"
                    title="Receitas por ano"
                    style="margin-left: 8px;">
                    <span class="selector-icon" aria-hidden="true"
                          style="display:inline-flex;align-items:center;margin-right:4px;">
                        <img src="assets/icons/calendar-days.svg" alt="Receitas Icon"
                             width="18" height="18" style="fill:currentColor;"/>
                    </span>
                    Receitas por Ano
                </button>
            </div>
            <button *ngIf="isDetailView" (click)="createChartByView()" class="back-button">&larr; Voltar para Opções
            </button>
        </div>
        <div class="chart-container" [ngClass]="{'bank-chart-container': selectedView === 'banco'}"
             style="padding-top: 1.5rem">
            <div *ngIf="!hasExpenses" class="no-expenses-message">
                Não há despesas para exibir. 😀
            </div>
            <canvas #mainChart *ngIf="hasExpenses" id="main-chart"></canvas>
        </div>
    </div>

    <div class="card top-categories-card">
        <h2 class="top-categories-title">Categorias com maiores gastos</h2>
        <ul class="top-categories-list">
            <li *ngFor="let cat of topExpenseCategories; let i = index" class="top-category-item">
                <span class="top-category-icon" [style.background-color]="getCategoryColor(cat.category) || '#ef4444'">
                    <img
                        [src]="getCategoryIcon(cat.category)"
                        alt="icon"
                    />
                </span>
                <span class="top-category-name">{{ cat.category }}</span>
                <span class="top-category-value">{{ cat.value | currency:'BRL' }}</span>
            </li>
        </ul>
    </div>

    <div class="card year-month-filter" style="margin-bottom: 1rem;">
        <div class="header-with-image">
            <img src="assets/icons/filter.svg" alt="Calendar Icon" width="24" height="24"
                 style="vertical-align: middle;"/>
            <h3 class="table-title">Filtrar por Ano e Mês</h3>
        </div>
        <div class="years-row">
            <span *ngFor="let year of availableYears" style="margin-right: 8px;">
                <button
                    (click)="selectYear(year)"
                    [class.selected]="selectedYear === year"
                    class="year-btn">
                    {{ year }}
                </button>
            </span>
        </div>
        <h4 *ngIf="selectedYear">Mês</h4>
        <div class="months-row" *ngIf="selectedYear">
            <span *ngFor="let month of [1,2,3,4,5,6,7,8,9,10,11,12]" style="margin-right: 4px;">
                <button
                    [disabled]="!availableMonthsByYear[selectedYear] || !availableMonthsByYear[selectedYear].includes(month)"
                    (click)="selectMonth(selectedYear, month)"
                    [class.selected]="selectedMonth === month"
                    class="month-btn">
                    {{ monthNamePerNumber[month] }}
                </button>
            </span>
        </div>
    </div>

    <div class="card">
        <h2 class="table-title">Detalhes das Transações</h2>
        <app-transactions-table [transactions]="transactions"></app-transactions-table>
    </div>
</div>

<ng-template #noData>
    <div class="card no-data-container">

        <h2>Nenhum dado para exibir</h2>
        <p>Por favor, vá para a página de <strong>Importar</strong> para carregar um ficheiro financeiro.</p>
    </div>
</ng-template>


